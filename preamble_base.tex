\usepackage[a4paper]{geometry}

\usepackage[utf8]{inputenc}                               % encoding: utf-8 (nordic letters)
\usepackage[T1]{fontenc}                                  % use 8-bit encoded fonts
\renewcommand{\sfdefault}{phv}                            % changes the default font

% Tables and figures
\usepackage{tabularx,booktabs,authblk}
\usepackage{framed}

% Figures and captions
\usepackage{caption}
\usepackage{subcaption}
\usepackage{wrapfig}
\usepackage{rotating}

% Hypermedia
\usepackage{url}
\usepackage[hidelinks]{hyperref}

%Macros taken from the preamble of the MatFysTutor LaTeX Guide.
\newcommand*{\http}[1]{\href{http://#1}{#1}}    % macro for http links: \http{www.matfystutor.dk}
\newcommand*{\mailto}[1]{\href{mailto:#1}{#1}}  % macro for mails: \mailto{email@email.com}

% Stylization
\usepackage{lastpage}
\usepackage{fancyhdr}
\pagestyle{fancy}

% Variables
\usepackage{pgfkeys}                                       % Initialize the variable key-value parirs

\newcommand{\setvalue}[1]{\pgfkeys{/variables/#1}}
\newcommand{\getvalue}[1]{\pgfkeysvalueof{/variables/#1}}
\newcommand{\declare}[1]{%
 \pgfkeys{
  /variables/#1.is family,
  /variables/#1.unknown/.style = {\pgfkeyscurrentpath/\pgfkeyscurrentname/.initial = ##1}
 }%
}

\declare{}

% LaTeX Programming

\usepackage{xparse}                                         % Scanning arguments
\usepackage{xifthen}                                        % Conditionals
\usepackage{xstring}                                        % String functions
\usepackage{calc}                                           % Calculations


% Math
\usepackage{mathtools, amsmath}
\allowdisplaybreaks % allow pagebreaks in align*
\usepackage{cancel}

\usepackage{amssymb}
% \usepackage[utopia]{mathdesign}
\usepackage{stmaryrd}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it} 

% Math shortcuts
\renewcommand{\implies}{\Rightarrow}
\renewcommand{\iff}{\Leftrightarrow}
\renewcommand{\d}{\, \mathrm{d}}                               % \d = differential d with a bit of spacing
\newcommand{\e}{\mathrm{e}}                                    % \e = eulers number
\newcommand{\R}{\mathbb{R}}                                    % \R = Real numbers
\newcommand{\N}{\mathbb{N}}                                    % \N = Natural numbers
\newcommand{\Z}{\mathbb{Z}}                                    % \Z = Integers
\newcommand{\C}{\mathbb{C}}                                    % \C = Complex numbers
\newcommand{\Q}{\mathbb{Q}}                                    % \Q = Rational numbers
\newcommand{\F}{\mathbb{F}}                                    % \F = Field
\newcommand{\K}{\mathbb{K}}                                    % \K = Field \R and \C
\newcommand{\V}{\mathpzc{V}}                                   % \V
\newcommand{\W}{\mathpzc{W}}                                   % \W
\renewcommand{\S}{\mathbb{S}}                                  % \S = Set of permutations
\newcommand{\Id}{\text{Id}}                                    % \Id = Identity function

\newcommand{\Det}[1]{\text{Det}\left( #1 \right)}              % \Det{arg}             Det(arg)
\newcommand{\Span}[1]{\text{Span}\left( #1 \right)}            % \Span{arg}            Span(arg)
\newcommand{\sgn}[1]{\text{sgn} \left( #1 \right)}             % \sgn{arg}             sgn(arg)
\newcommand{\adj}[1]{\text{adj} \left( #1 \right)}             % \adj{arg}             adj(arg)
\newcommand{\ord}[1]{\text{ord} \left( #1 \right)}             % \ord{arg}             ord(arg)

\newcommand{\tuple}[1]{\left\langle #1 \right\rangle}          % \tuple{arg}           <arg>
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}              % \abs{arg}             absolute/modulo of value
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}             % \norm{arg}            norm of a value
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}             % \ceil{arg}            ceiling of a value
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}          % \floor{arg}           floor of a value
\newcommand{\inprod}[2]{\tuple{#1, #2}}                        % \inprod{v}{w}         inner product
\newcommand{\powgroup}[1]{\tuple{#1}}                          % \powgroup{arg}        image of f={g^n | n in Z}

% Logic and proofs
\usepackage{amsthm}                                % Theorem package
\theoremstyle{definition}                          % plain, definition, remark
\usepackage{lplfitch}                              % fitch style proofs
%\usepackage{bussproofs}                            % proof trees
%\usepackage{logicproof}                           % alternative package, resembling the dBerLog book
%\setlength\subproofhorizspace{2em}                % Indent for subproofs. Changed for fresh variables

% Color and presets
%\usepackage{xcolor}                               % basic xcolor package
\usepackage[table,xcdraw]{xcolor}                  % xcolor package with support for tables
\usepackage{colortbl}                              % color presets working together with xcolor

\definecolor{lstComment}{rgb}{0.45,0.45,0.45}      % code: comments (Grey)
\definecolor{lstKey}{rgb}{0.13,0.21,1}             % code: primary keywords (Blue)
\definecolor{lstKey2}{rgb}{1,0.666667,0.13726}     % code: secondary keywords (Day[9] Orange)
\definecolor{lstString}{rgb}{0.1,0.65,0.1}         % code: strings (Green)
\definecolor{lstBase}{rgb}{0.0,0.0,0.0}            % code: base (Black)

% Tikz
\usepackage{tikz}                                % import basepackage
\usetikzlibrary{calc}                            % Coordinate calcuations
\usetikzlibrary{positioning}                     % Relative positioning
\usetikzlibrary{shapes}                          % Defining nodeshapes and more (isa for E/R)
\usepackage{tikz-qtree}                          % import simple tree macro
\usetikzlibrary{arrows}                          % arrows for trees
\usetikzlibrary{automata}

% lstlisting
\usepackage{listings}


% Custom language definitions
% Definition of Pseudocode
\lstdefinelanguage{pseudocode}{
  keywords=[1]{
           procedure, break, break, by, do, downto, else, error, for, if, let, repeat, return, then, to, until, while, while, end
      },                                           % list of keywords, first and last are not used for some stupid reason
  keywords=[2]{
        and, and, or, NIL, NIL
  }
  sensitive=false,                                 % keywords are not case-sensitive
  morecomment=[l]{//},                             % l is for line comment
  morecomment=[s]{/*}{*/},                         % s is for start and end delimiter
  morestring=[b]"                                  % strings are enclosed in double quotes
}


% lstlisting - General settings
\lstset{
  language=pseudocode,                             % choose language
  escapeinside={*@}{@*},                           % if you want to add LaTeX within your code
  literate={æ}{{\ae}}1{ø}{{\oe}}1{å}{{\aa}}1       % allow æ, ø and å in code
           {Æ}{{\AE}}1{Ø}{{\O}}1{Å}{{\AA}}1,       %     (this change was taken from the preamble of the MatFysTutor LaTeX Guide)
}

% lstlisting - Whitespace
\lstset{
  showspaces=false,                                % show spaces everywhere - adding particular underscores
  showstringspaces=false,                          % underline spaces within strings only.
  showtabs=false,                                  % show tabs within strings adding particular underscores.
  % breaklines=true,                                 % automatically break lines
  % breakatwhitespace=true,                          % automatically break should there only be white space.
  tabsize=4                                        % tab width
}

\lstset{
  xleftmargin= .05\textwidth,                       % leftmargin being 10% of the current width
  xrightmargin= .05\textwidth,                      % right margin also 10%
}

% lstlisting - Minimalistic borders and captions
\lstset{
  frame=top,                                       % bar on top
  frame=bottom,                                    % bar on bottom
  captionpos=b                                     % caption at the bottom
}
\DeclareCaptionFormat{listing}{\makebox[0.5in][l]{#1#2}\parbox[t]{\dimexpr \captionwidth-0.5in}{#3}\hline}
\captionsetup[lstlisting]{format=listing, singlelinecheck=off, labelsep=colon}

% protocol
\usepackage{environ}
\usepackage{newfloat}
\DeclareFloatingEnvironment[
    name=Protocol,
    placement=htbp!,
]{protocolenv}

\NewEnviron{protocol}[2]  
    {\begin{protocolenv}%
        \begin{framed}%
          \BODY%
        \end{framed}%
        \caption{#1}\label{prot:#2}%
     \end{protocolenv}}

% TODO
\newcommand{\TODO}{{\large \color{red} \textit{TODO}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%      Title and information       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setvalue{title = }
\setvalue{subtitle = }

\DeclareDocumentCommand \settitle { m g }{                 % \setTitle{title}{subtitle}
     \setvalue{title = #1}
     \IfValueTF {#2} { \setvalue{subtitle = #2} \title{\huge \getvalue{title} \\ \large \getvalue{subtitle}}}
                      { \title{\huge \getvalue{title}} }
}

\DeclareDocumentCommand \addauth { m g g }{                % \addAuth{name}{email}{id}
     \IfValueT {#3} {                                      % Set the id text as desired on the top left
         \setvalue{id = #3}
     }
     \pgfkeysifdefined{/variables/name}{
         \setvalue{id = \, et al}
     }{
         \setvalue{name = #1}
     }     
     \author{#1}
     \IfValueT {#2} {
        \pgfkeysifdefined{/variables/email}{
            % Do Nothing
        }{
             \setvalue{email = #2}
         }
         \IfValueTF {#3} {
         	\affil{#3, \protect\href{mailto:#2}{#2}}
         }
         {
         	\affil{\protect\href{mailto:#2}{#2}}
         }
     }
}


\date{\today}

\fancyhead[RO]{\thepage}
\fancyhead[LO]{\getvalue{title}}

%Nothing below
\fancyfoot[LCR]{}

% misc.
\usepackage{float}
\usepackage{enumitem}
